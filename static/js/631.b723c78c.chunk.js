"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[631],{9780:function(e,t,o){var r=o(7313),n=o(6149),s=o(3604),a=o(9019),i=o(8119),l=o(1113),c=o(2247),d=o(6467),u=o(9536),h=o(4117),m=o(1095),g=o(1163),p=o(647),x=o(483),f=o(9632),v=o(6937),j=o(5091),Z=o(4676),y=o(2639),b=o(4180),w=o(6863),S=o(6287),C=o(7122),_=o(659),k=o(4149),z=(o(6029),o(1746)),E=o(7227),P=o(4859),T=o(3127),B=o(3650),L=o(6417);const A={customNode:B.Z};t.Z=e=>{let{isOpen:t,onClose:o,leadDetails:B}=e;const[N,D]=(0,r.useState)(!1),{user:I}=(0,C.E)(),{logout:U}=(0,_.a)(),[W,O,$]=(0,z.Rr)([]),[R,M,F]=(0,z.ll)([[]]),H=(0,r.useCallback)((e=>M((t=>(0,z.Z_)(e,t)))),[M]);(0,r.useEffect)((()=>{(async()=>{try{if(D(!0),!B)return;const e=await fetch(S.Z.apiUrl+`api/followups/by-lead/${B.id}`,{method:"GET",headers:{Authorization:`Bearer ${I.token}`}});if(e.ok){const t=await e.json();console.log("followup data",t);const o=t.map(((e,t)=>{let o,r,n,s;t%3==0&&(o=150,r=t/3*100,n="right",s="top"),t%3==1&&(o=350,r=(t-1)/3*100,n="right",s="left"),t%3==2&&(o=550,r=(t-2)/3*100,n="bottom",s="left"),r+=50;let a="#e6e3e3";return"New"==e.status&&(a="#c7dbff"),"Dropped"!=e.status&&"Fake"!=e.status||(a="#ffc7d0"),"Duplicate"==e.status&&(a="#fcbca7"),"Registered"==e.status&&(a="#c4ffc2"),"Next intake"==e.status&&(a="#fff2d1"),{id:t.toString(),sourcePosition:n,targetPosition:s,position:{x:o,y:r},type:"customNode",data:{label:e.status,date:e.date,color:a,comment:e.comment},handle:{x:.5,y:1}}})),r=t.map(((e,t)=>({id:`e${t}-${t+1}`,source:t.toString(),type:"smoothstep",animated:!0,target:(t+1).toString()})));O(o),M(r)}else console.error("Error fetching followup:",e.statusText),401===e.status?(console.error("Unauthorized access. Logging out."),U()):console.error("Error fetching lead data:",e.statusText)}catch(e){console.error("Error fetching followup:",e.message)}finally{D(!1)}})()}),[B]);const G=()=>{o()};return B?(0,L.jsxs)(n.Z,{open:t,onClose:G,fullWidth:!0,maxWidth:"md",children:[(0,L.jsx)(s.Z,{children:(0,L.jsxs)(a.ZP,{container:!0,alignItems:"center",spacing:2,children:[(0,L.jsx)(a.ZP,{item:!0,children:(0,L.jsx)(i.Z,{children:(0,L.jsx)(g.Z,{})})}),(0,L.jsxs)(a.ZP,{item:!0,children:[(0,L.jsx)(l.Z,{variant:"h3",children:B.name}),(0,L.jsxs)(l.Z,{variant:"h5",color:"textSecondary",children:[B.branch," | ",B.course]})]})]})}),(0,L.jsx)(c.Z,{sx:{mt:3,mb:2}}),(0,L.jsx)(d.Z,{children:(0,L.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,L.jsxs)(a.ZP,{item:!0,xs:12,sm:6,children:[(0,L.jsx)(u.Z,{mb:2,children:(0,L.jsx)(l.Z,{variant:"h4",children:"Student Details"})}),V("Location",B.address,(0,L.jsx)(p.Z,{})),V("NIC",B.nic,(0,L.jsx)(y.Z,{})),V("Email",B.email,(0,L.jsx)(f.Z,{})),V("Phone",B.contact_no,(0,L.jsx)(v.Z,{})),V("DOB",B.dob,(0,L.jsx)(w.Z,{}))]}),(0,L.jsxs)(a.ZP,{item:!0,xs:12,sm:6,children:[(0,L.jsx)(u.Z,{mb:2,children:(0,L.jsx)(l.Z,{variant:"h4",children:"Other Details"})}),V("Course",B.course,(0,L.jsx)(x.Z,{})),V("Branch",B.branch,(0,L.jsx)(Z.Z,{})),V("Counsellor",B.counsellor,(0,L.jsx)(g.Z,{})),V("Status",B.status,(0,L.jsx)(j.Z,{})),V("Source",B.source,(0,L.jsx)(b.Z,{}))]}),(0,L.jsxs)(a.ZP,{item:!0,xs:12,children:[(0,L.jsx)(u.Z,{mb:2,children:(0,L.jsx)(l.Z,{variant:"h4",children:"Follow-up History"})}),N?(0,L.jsx)(k.Z,{}):(0,L.jsx)("div",{style:{width:"100%",height:"50vh"},children:(0,L.jsxs)(z.x$,{nodes:W,edges:R,onNodesChange:$,onEdgesChange:F,onConnect:H,nodeTypes:A,children:[(0,L.jsx)(E.Z,{}),(0,L.jsx)(P.a,{}),(0,L.jsx)(T.A,{variant:"dots",gap:12,size:1})]})})]})]})}),(0,L.jsx)(c.Z,{sx:{mt:3,mb:2}}),(0,L.jsx)(h.Z,{children:(0,L.jsx)(m.Z,{onClick:G,color:"primary",children:"Close"})})]}):null;function V(e,t,o){if("DOB"===e&&t){t=new Date(t).toLocaleDateString()}return(0,L.jsx)(u.Z,{sx:{marginBottom:1},children:(0,L.jsxs)(l.Z,{variant:"body1",display:"flex",alignItems:"center",children:[o&&(0,L.jsx)("span",{style:{marginRight:"8px"},children:o}),(0,L.jsxs)("span",{children:[e,":"]}),"\xa0\xa0",t]})})}}},2016:function(e,t,o){var r=o(7313),n=o(6149),s=o(3604),a=o(9019),i=o(8119),l=o(1113),c=o(2247),d=o(6467),u=o(4631),h=o(6529),m=o(1405),g=o(1095),p=o(4117),x=o(5281),f=o(1163),v=o(3965),j=o(3463),Z=o(9429),y=o(6287),b=o(7122),w=o(7114),S=o.n(w),C=o(1399),_=o.n(C),k=o(6417);t.Z=e=>{let{isOpen:t,onClose:o,leadDetails:w}=e;const[C,z]=(0,r.useState)(""),[E,P]=(0,r.useState)(""),[T,B]=(0,r.useState)(""),L=_()(S().mixin({toast:!0,position:"bottom-end",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:3500,timerProgressBar:!0})),{user:A}=(0,b.E)(),N=()=>{o(),I()};let D;(0,r.useEffect)((()=>{!async function(){try{const e=await fetch(y.Z.apiUrl+"api/messageTemplates",{method:"GET",headers:{Authorization:`Bearer ${A.token}`,"Content-Type":"application/json"}});if(!e.ok)return 401===e.status&&(console.error("Unauthorized access. Logging out."),logout()),500===e.status?(console.error("Internal Server Error."),void logout()):void 0;const t=await e.json();console.log("data:",t),z(t)}catch(e){console.error(e)}}()}),[]);const I=()=>{P(""),B("")};return w?(0,k.jsx)(n.Z,{open:t,onClose:N,fullWidth:!0,maxWidth:"md",children:(0,k.jsx)(Z.J9,{initialValues:{contact_no:(null===w||void 0===w?void 0:w.contact_no)||"",message:""},validationSchema:j.Ry().shape({contact_no:j.Z_().matches(/^\+?\d{10,12}$/,"Contact No should be 10 to 12 digits with an optional leading + sign").required("Contact No is required"),message:j.Z_().required("Message is required")}),onSubmit:async(e,t)=>{let{setSubmitting:o}=t;const r={contact_no:e.contact_no,message:E?T:e.message};console.log("formData:",r);try{const e=await fetch(y.Z.apiUrl+"api/sendCustomSMS",{method:"POST",headers:{Authorization:`Bearer ${A.token}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(console.log("res:",e),!e.ok)return 401===e.status&&(console.error("Unauthorized access. Logging out."),logout()),500===e.status?(console.error("Internal Server Error."),void logout()):void 0;console.log("SMS sent successfully"),L.fire({icon:"success",title:"Message Sent Successfully."}),N()}catch(n){console.error(n),o(!1),L.fire({icon:"error",title:"Error sending message."})}},children:e=>{let{errors:t,handleBlur:o,handleChange:r,handleSubmit:n,isSubmitting:j,touched:Z,values:y,setFieldValue:b}=e;return(0,k.jsxs)("form",{onSubmit:n,children:[(0,k.jsx)(s.Z,{children:(0,k.jsxs)(a.ZP,{container:!0,alignItems:"center",spacing:2,children:[(0,k.jsx)(a.ZP,{item:!0,children:(0,k.jsx)(i.Z,{children:(0,k.jsx)(f.Z,{})})}),(0,k.jsxs)(a.ZP,{item:!0,children:[(0,k.jsx)(l.Z,{variant:"h3",children:"Send SMS"}),(0,k.jsxs)(l.Z,{variant:"h5",color:"textSecondary",children:[w.name," | ",w.course]})]})]})}),(0,k.jsx)(c.Z,{sx:{mt:3,mb:2}}),(0,k.jsx)(d.Z,{children:(0,k.jsxs)(a.ZP,{container:!0,spacing:2,children:[(0,k.jsx)(a.ZP,{item:!0,xs:12,children:(0,k.jsx)(u.Z,{label:"Contact Number",variant:"outlined",fullWidth:!0,name:"contact_no",value:y.contact_no,onBlur:o,onChange:r,error:Boolean(Z.contact_no&&t.contact_no),helperText:Z.contact_no&&t.contact_no})}),(0,k.jsxs)(a.ZP,{item:!0,xs:12,children:[(0,k.jsxs)(h.Z,{value:E,onChange:e=>((e,t)=>{const o=e.target.value;if(P(o),o){var r;const e=(null===(r=C.find((e=>e._id===o)))||void 0===r?void 0:r.body)||"";D=e.replace(/@studentName/g,w.name).replace(/@programName/g,w.course+" course"),B(D),t("message",D)}})(e,b),fullWidth:!0,displayEmpty:!0,inputProps:{"aria-label":"Select Template"},children:[(0,k.jsx)(m.Z,{value:"",disabled:!0,children:"Select Template"}),C.map((e=>(0,k.jsx)(m.Z,{value:e._id,children:e.title},e._id)))]}),(0,k.jsx)(g.Z,{onClick:I,color:"secondary",children:"Clear"})]}),(0,k.jsx)(a.ZP,{item:!0,xs:12,children:(0,k.jsx)(u.Z,{label:"Message",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,name:"message",value:E?T:y.message,onBlur:o,onChange:r,error:Boolean(Z.message&&t.message),helperText:Z.message&&t.message})})]})}),(0,k.jsx)(c.Z,{sx:{mt:3,mb:2}}),(0,k.jsxs)(p.Z,{children:[(0,k.jsx)(g.Z,{onClick:N,color:"primary",children:"Cancel"}),(0,k.jsx)(g.Z,{endIcon:j?(0,k.jsx)(x.Z,{size:20,color:"inherit"}):(0,k.jsx)(v.Z,{}),type:"submit",color:"primary",disabled:j||!E&&!y.message,children:"Send"})]})]})}})}):null}},3650:function(e,t,o){var r=o(7313),n=o(1746),s=o(9224),a=o(6417);const i=s.ZP.div`
  padding: 10px 20px;
  border-radius: 5px;
  background: ${e=>e.theme.nodeBg};
  color: ${e=>e.theme.nodeColor};
  border: 1px solid ${e=>e.selected?e.theme.primary:e.theme.nodeBorder};

  .react-flow__handle {
    background: ${e=>e.theme.primary};
    width: 8px;
    height: 10px;
    border-radius: 5px;
  }
`;t.Z=(0,r.memo)((e=>{let{data:t,selected:o}=e;return(0,a.jsx)("div",{style:{backgroundColor:t.color,borderRadius:"5px"},children:(0,a.jsxs)(i,{selected:o,children:[(0,a.jsx)(n.HH,{type:"target",position:n.Ly.Left}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:t.label}),(0,a.jsx)("p",{style:{marginTop:"-2px"},children:t.date}),(0,a.jsx)("div",{style:{width:130},children:(0,a.jsx)("p",{style:{marginTop:"-5px",fontSize:12},width:20,children:t.comment})})]}),(0,a.jsx)(n.HH,{type:"source",position:n.Ly.Right})]})})}))},4299:function(e,t,o){o.r(t),o.d(t,{default:function(){return Y}});var r=o(7313),n=o(9019),s=o(3497),a=o(4813),i=o(4631),l=o(5281),c=o(1113),d=o(1727),u=o(9860),h=o(40),m=o(297),g=o(8370),p=o(5769),x=o(8832),f=o(1997),v=o(8623),j=o(4090),Z=o(5927),y=o(5211),b=o(8975),w=o(7983),S=o(3587),C=o(1095),_=o(7890),k=o(7122),z=o(4149),E=o(6287),P=o(659),T=o(9780),B=o(2016),L=o(1689),A=o(7114),N=o.n(A),D=o(1399),I=o.n(D),U=o(7592),W=o(7551),O=o(430),$=o(7841),R=o(5551),M=o(7030),F=o(8406),H=o(1163),G=o(315),V=o(6417);const q=.2,J=(0,U.ZP)(O._$)((e=>{let{theme:t}=e;return{[`& .${$._.row}.even`]:{backgroundColor:t.palette.grey[200],"&:hover, &.Mui-hovered":{backgroundColor:(0,W.Fq)(t.palette.primary.main,q),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,W.Fq)(t.palette.primary.main,q+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,W.Fq)(t.palette.primary.main,q+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,W.Fq)(t.palette.primary.main,q+t.palette.action.selectedOpacity)}}}}}}));function Y(){var e,t,o,A;const{logout:D}=(0,P.a)(),{user:U}=(0,k.E)(),{permissions:W}=U||{},{userType:O}=U||{},$=(0,_.s0)(),q=(0,u.Z)(),Y=(0,a.Z)(q.breakpoints.down("md")),K={Facebook:(0,V.jsx)(h.Z,{color:"primary",style:{color:"blue"}}),Manual:(0,V.jsx)(p.Z,{color:"primary",style:{color:"green"}}),Internal:(0,V.jsx)(g.Z,{color:"primary",style:{color:"orange"}}),Referral:(0,V.jsx)(S.Z,{color:"primary",style:{color:"green"}}),"Bulk Upload":(0,V.jsx)(m.Z,{color:"primary",style:{color:"orange"}})},[Q,X]=(0,r.useState)([]),[ee,te]=(0,r.useState)([]),[oe,re]=(0,r.useState)([]),[ne,se]=(0,r.useState)(""),[ae,ie]=(0,r.useState)(""),[le,ce]=(0,r.useState)(""),[de,ue]=(0,r.useState)(""),[he,me]=(0,r.useState)(""),[ge,pe]=(0,r.useState)(""),[xe,fe]=(0,r.useState)(!0),[ve,je]=(0,r.useState)(null),[Ze,ye]=(0,r.useState)(""),[be,we]=(0,r.useState)([]),[Se,Ce]=(0,r.useState)([]),[_e,ke]=(0,r.useState)([]),[ze,Ee]=(0,r.useState)(!1),[Pe,Te]=(0,r.useState)([]),[Be,Le]=(0,r.useState)([]),Ae=["admin","sup_admin","gen_supervisor","admin_counselor"].includes(null===O||void 0===O?void 0:O.name),Ne=I()(N().mixin({toast:!0,position:"bottom-end",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:3500,timerProgressBar:!0})),De=()=>{Ne.fire({icon:"success",title:"Status Reversed Successfully."})},Ie=()=>{Ne.fire({icon:"error",title:"Error Occured."})},Ue=()=>{Ne.fire({icon:"success",title:"Leads Deleted Successfully."})},We=()=>{Ne.fire({icon:"error",title:"Error Occured While Deleting Leads."})},Oe=[{field:"source",headerName:"",width:10,align:"center",renderCell:e=>(0,V.jsx)(L.Z,{title:e.row.source,arrow:!0,children:K[e.row.source]})},{field:"reference_number",headerName:"#",align:"center",width:55,headerAlign:"center"},{field:"date",headerName:"Date",flex:0,width:100,minWidth:50},{field:"name",headerName:"Student Name",flex:.5,width:100,minWidth:150},{field:"contact_no",headerName:"Contact No",flex:1,width:100,minWidth:150},{field:"status",headerName:"Status",flex:1,width:100,minWidth:130},{field:"course_code",headerName:"Course",flex:.5,width:100,minWidth:50},{field:"counsellor",headerName:"Assign To",description:"This column has a value getter and is not sortable.",sortable:!1,flex:1,width:100,minWidth:150,align:"left",renderCell:e=>Ae?(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(v.Z,{disablePortal:!0,id:"combo-box-demo",options:Pe.concat(Be),sx:{width:200,my:2},renderInput:e=>(0,V.jsx)(i.Z,{...e,variant:"standard"}),value:e.row.counsellor,onChange:(t,o)=>{console.log("cid1",e.row.counsellor),console.log("cid",o.label),console.log("lid",e.row.id);const r=e.row.id,n=o.id;e.row.counsellor=o.label;(async()=>{try{const e=await fetch(E.Z.apiUrl+"api/counsellorAssignment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${U.token}`},body:JSON.stringify({counsellor_id:n,lead_id:r})});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),D();else{if(500===e.status)return console.error("Internal Server Error."),void D();console.error("Error updating lead data",e.statusText)}return}console.log(o.label),console.log("Successfully assigned"),Ne.fire({icon:"success",title:"Assignment Successfull."})}catch(e){console.log(e),Ne.fire({icon:"error",title:"Error While Assigning."})}})()}})}):(0,V.jsx)(V.Fragment,{children:e.row.counsellor?`Assigned to ${e.row.counsellor}`:"Pending"})},{field:"sms",headerName:"",description:"This column has a value getter and is not sortable.",sortable:!1,width:50,align:"left",renderCell:()=>(0,V.jsx)(C.Z,{variant:"contained",color:"primary",sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px",backgroundColor:"#ffa500","&:hover":{backgroundColor:"#ff8c00"}},children:(0,V.jsx)(G.Z,{sx:{fontSize:"18px"}})})},{field:"edit",headerName:"",description:"This column has a value getter and is not sortable.",sortable:!1,width:125,align:"right",renderCell:e=>{var t;return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(C.Z,{variant:"contained",color:"primary",onClick:()=>{var t;t=e.row.id,console.log("clicked lead id",t),$("/app/leads/update?id="+t)},sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px"},children:(0,V.jsx)(x.Z,{sx:{fontSize:"18px"}})}),(null===W||void 0===W||null===(t=W.lead)||void 0===t?void 0:t.includes("delete"))&&(0,V.jsx)(C.Z,{variant:"contained",color:"error",onClick:()=>{Ge(e.row.id)},style:{marginLeft:"5px"},sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px"},children:(0,V.jsx)(f.Z,{sx:{fontSize:"18px"}})}),"Registered"!=e.row.status&&"Fake"!=e.row.status&&"Duplicate"!=e.row.status&&"Dropped"!=e.row.status&&(0,V.jsx)(C.Z,{variant:"contained",color:"success",onClick:()=>{$("/app/leads/addfollowup?id="+e.row.id)},style:{marginLeft:"5px"},sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px",backgroundColor:"#039116"},children:(0,V.jsx)(R.Z,{sx:{fontSize:"18px",color:"white"}})}),("Registered"==e.row.status||"Fake"==e.row.status||"Duplicate"==e.row.status||"Dropped"==e.row.status)&&(0,V.jsx)(C.Z,{variant:"contained",color:"success",onClick:()=>{(async e=>{try{console.log("my lead id",e);const t=await fetch(E.Z.apiUrl+"api/lead-restore/",{method:"POST",headers:{Authorization:`Bearer ${U.token}`,"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(!t.ok){if(401===t.status)console.error("Unauthorized access. Logging out."),D();else{if(500===t.status)return console.error("Internal Server Error."),void D();Ie(),console.error("Error fetching sources:",t.statusText)}return}{const e=await t.json();console.log(e),fe(!0),De(),Re()}}catch(t){Ie(),console.error("Error fetching sources:",t.message)}})(e.row.id)},style:{marginLeft:"5px"},sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px",backgroundColor:"#d1bd0a"},children:(0,V.jsx)(M.Z,{sx:{fontSize:"18px",color:"white"}})})]})}}],$e=e=>{if("other"===e.toLowerCase())return"Other";return e.split(" ").map((e=>e.replace(/[()]/g,"").charAt(0).toUpperCase())).join("")};async function Re(){try{var e,t,o;const r=E.Z.apiUrl+"api/leads-details",n=await fetch(r,{method:"GET",headers:{Authorization:`Bearer ${U.token}`}});if(!n.ok){if(401===n.status)console.error("Unauthorized access. Logging out."),D();else{if(500===n.status)return console.error("Internal Server Error."),void D();console.error("Error fetching leads data",n.statusText)}return}let s=await n.json();if(s=s.map((e=>{const t=e.student_id||{};return{reference_number:e.reference_number,id:e._id,date:e.date,scheduled_at:e.scheduled_at||null,scheduled_to:e.scheduled_to||null,name:t.name||null,contact_no:t.contact_no||null,address:t.address||null,dob:t.dob||null,email:t.email||null,nic:t.nic||null,course:e.course_id.name,course_code:$e(e.course_id.name),branch:e.branch_id.name,source:e.source_id?e.source_id.name:null,counsellor:e.counsellor_id?e.counsellor_id.name:null,counsellor_id:e.counsellor_id?e.counsellor_id._id:null,assigned_at:e.counsellorAssignment?e.counsellorAssignment.assigned_at:null,user_id:e.user_id||null,status:e.status_id?e.status_id.name:null}})),null!==W&&void 0!==W&&null!==(e=W.lead)&&void 0!==e&&e.includes("read-all"))return ke(s),re(s),void fe(!1);if(null!==W&&void 0!==W&&null!==(t=W.lead)&&void 0!==t&&t.includes("read")&&"counselor"===(null===O||void 0===O?void 0:O.name)){const e=s.filter((e=>e.counsellor_id===U._id));return ke(e),re(e),void fe(!1)}if(null!==W&&void 0!==W&&null!==(o=W.lead)&&void 0!==o&&o.includes("read")&&"user"===(null===O||void 0===O?void 0:O.name)){const e=s.filter((e=>e.user_id===U._id));return ke(e),re(e),void fe(!1)}}catch(r){console.log("Error fetching leads:",r)}}(0,r.useEffect)((()=>{Re();(async()=>{try{const e=await fetch(E.Z.apiUrl+"api/courses",{method:"GET",headers:{Authorization:`Bearer ${U.token}`}});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),D();else{if(500===e.status)return console.error("Internal Server Error."),void D();console.error("Error fetching courses:",e.statusText)}return}{const t=await e.json();X(t)}}catch(e){console.error("Error fetching courses:",e.message)}})();(async()=>{try{const e=await fetch(E.Z.apiUrl+"api/source",{method:"GET",headers:{Authorization:`Bearer ${U.token}`}});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),D();else{if(500===e.status)return console.error("Internal Server Error."),void D();console.error("Error fetching sources:",e.statusText)}return}{const t=await e.json();te(t)}}catch(e){console.error("Error fetching sources:",e.message)}})(),async function(){try{const e=await fetch(E.Z.apiUrl+"api/getCounsellors",{method:"GET",headers:{Authorization:`Bearer ${U.token}`}});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),D();else{if(500===e.status)return console.error("Internal Server Error."),void D();console.error("Error fetching counselors:",e.statusText)}return}const t=await e.json();Te(t)}catch(e){console.log("Error fetching counselors:",e)}}(),async function(){try{const e=await fetch(E.Z.apiUrl+"api/getAdminCounselors",{method:"GET",headers:{Authorization:`Bearer ${U.token}`}});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),D();else{if(500===e.status)return console.error("Internal Server Error."),void D();console.error("Error fetching counselors:",e.statusText)}return}const t=await e.json();Le(t)}catch(e){console.log("Error fetching counselors:",e)}}()}),[]),(0,r.useEffect)((()=>{!async function(){try{const e=await fetch(E.Z.apiUrl+"api/status",{method:"GET",headers:{Authorization:`Bearer ${U.token}`}});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),D();else{if(500===e.status)return console.error("Internal Server Error."),void D();console.error("Error fetching status:",e.statusText)}return}{const t=await e.json();we(t)}}catch(e){console.error("Error fetching status:",e.message)}}()}),[]);const Me=(e,t)=>!t||e===t,Fe=e=>{if(!de&&!he)return!0;const t=new Date(e),o=de?new Date(de):null,r=he?new Date(he):null;return o&&r?t>=o&&t<=r:o?t>=o:!r||t<=r};(0,r.useEffect)((()=>{(()=>{const e=oe.filter((e=>{const t=Me(e.course,ne),o=Me(e.source,ae),r=Me(e.status,Ze),n=Fe(e.date),s=Me(e.counsellor,le);return t&&o&&r&&n&&s}));ke(e)})()}),[ne,ae,Ze,de,he,le]);const He=(e,t)=>{const o=oe.filter((o=>{const r=new Date(o.date),n=e?new Date(e):null,s=t?new Date(t):null;return e&&t?r>=n&&r<=s:e?r>=n:!t||r<=s}));ke(o),console.log(o)};const Ge=e=>{N().fire({title:"Are you sure?",text:"You will not be able to recover this file!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it"}).then((t=>{t.isConfirmed&&async function(e){Ee(!0);try{const t=await fetch(E.Z.apiUrl+"api/leads-archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${U.token}`},body:JSON.stringify({ids:e})});if(!t.ok){if(401===t.status)console.error("Unauthorized access. Logging out."),D();else{if(500===t.status)return console.error("Internal Server Error."),void D();console.error("Error fetching sources:",t.statusText),We()}return}{const e=await t.json();console.log(e),fe(!0),Re(),Ue()}}catch(t){console.error("Error fetching sources:",t.message),We()}finally{Ee(!1)}}([e])}))};return(0,V.jsx)(V.Fragment,{children:(0,V.jsxs)(s.Z,{title:"View Leads",isDeleting:ze,arrIds:Se,buttonLabel:null!==W&&void 0!==W&&null!==(e=W.lead)&&void 0!==e&&e.includes("create")?(0,V.jsxs)(V.Fragment,{children:["Add New Lead",(0,V.jsx)(y.Z,{style:{marginLeft:"5px"}})," "]}):void 0,onButtonClick:function(){$("/app/leads/add")},buttonLabelExport:null!==W&&void 0!==W&&null!==(t=W.lead)&&void 0!==t&&t.includes("read-all")?(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(b.Z,{style:{fontSize:"25px"}})," "]}):void 0,buttonLabelDeleteAll:Se.length>1&&(null===W||void 0===W||null===(o=W.lead)||void 0===o?void 0:o.includes("delete-all"))&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(f.Z,{sx:{fontSize:"20px"}}),ze?(0,V.jsx)(l.Z,{size:24,color:"inherit"}):(0,V.jsx)("span",{style:{marginLeft:"8px",fontWeight:"bold"},children:"Delete Leads"})]}),onButtonClickDeleteAll:()=>{Se.length>1?N().fire({title:"Are you sure?",text:"You will not be able to recover this file!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it"}).then((e=>{e.isConfirmed&&async function(){Ee(!0);try{const e=await fetch(E.Z.apiUrl+"api/leads-archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${U.token}`},body:JSON.stringify({ids:Se})});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),D();else{if(500===e.status)return console.error("Internal Server Error."),void D();console.error("Error fetching sources:",e.statusText),We()}return}{const t=await e.json();console.log(t),fe(!0),Ce([]),Re(),Ue()}}catch(e){console.error("Error fetching sources:",e.message),We()}finally{Ee(!1)}}()})):Ne.fire({icon:"error",title:"No Lead Selected."})},onButtonClickExport:()=>{const e=[],t=Object.keys(_e[0]);e.push(t.join(","));for(const a of _e){const o=t.map((e=>`"${(""+a[e]).replace(/"/g,'\\"')}"`));e.push(o.join(","))}const o=e.join("\n"),r=new Blob([o],{type:"text/csv"}),n=window.URL.createObjectURL(r),s=document.createElement("a");s.setAttribute("hidden",""),s.setAttribute("href",n),s.setAttribute("download","leads.csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s)},children:[xe&&(0,V.jsx)(z.Z,{style:{marginBottom:"30px"}}),(0,V.jsxs)(n.ZP,{style:{marginTop:"-30px"},container:!0,direction:"column",justifyContent:"left",children:[(0,V.jsxs)(n.ZP,{container:!0,sx:{p:3,marginTop:"4px"},spacing:Y?0:2,children:[(0,V.jsx)(n.ZP,{container:!0,direction:"column",children:(0,V.jsxs)(n.ZP,{container:!0,spacing:Y?0:2,children:[(0,V.jsxs)(n.ZP,{item:!0,xs:12,sm:2.5,children:[(0,V.jsx)(c.Z,{variant:"h6",component:"h6",style:{marginBottom:"-10px"},children:"Search"}),(0,V.jsx)(i.Z,{fullWidth:!0,margin:"normal",name:"search",type:"text",size:"small",SelectProps:{native:!0},value:ge,onChange:e=>{const{value:t}=e.target;pe(t),(e=>{const t=oe.filter((t=>{const o=e.toLowerCase();return t.name&&t.name.toLowerCase().includes(o)||t.nic&&t.nic.toLowerCase().includes(o)||t.email&&t.email.toLowerCase().includes(o)||t.contact_no&&t.contact_no.toLowerCase().includes(o)}));ke(t),console.log(t)})(t)},InputProps:{startAdornment:(0,V.jsx)(d.Z,{position:"start",children:(0,V.jsx)(w.Z,{})})}})]}),(0,V.jsxs)(n.ZP,{item:!0,xs:12,sm:1.5,children:[(0,V.jsx)(c.Z,{variant:"h6",component:"h6",style:{marginBottom:"-10px"},children:"Course"}),(0,V.jsxs)(i.Z,{fullWidth:!0,margin:"normal",name:"course",size:"small",select:!0,SelectProps:{native:!0},value:ne,onChange:e=>{se(e.target.value),console.log(e.target.value),(e=>{const t=oe.filter((t=>t.course===e));ke(t),console.log(t)})(e.target.value)},InputProps:{startAdornment:(0,V.jsx)(d.Z,{position:"start",children:(0,V.jsx)(j.Z,{})})},children:[(0,V.jsx)("option",{value:"",disabled:!0}),Q&&Q.length>0?Q.map((e=>(0,V.jsx)("option",{value:e.name,children:e.name},e._id))):(0,V.jsx)("option",{value:"",disabled:!0,children:"No Courses available"})]})]}),(0,V.jsxs)(n.ZP,{item:!0,xs:12,sm:1.5,children:[(0,V.jsx)(c.Z,{variant:"h6",component:"h6",style:{marginBottom:"-10px"},children:"Source"}),(0,V.jsxs)(i.Z,{fullWidth:!0,margin:"normal",name:"media",size:"small",select:!0,SelectProps:{native:!0},value:ae,onChange:e=>{ie(e.target.value),(e=>{const t=oe.filter((t=>t.source===e));ke(t),console.log(t)})(e.target.value)},InputProps:{startAdornment:(0,V.jsx)(d.Z,{position:"start",children:(0,V.jsx)(Z.Z,{})})},children:[(0,V.jsx)("option",{value:"",disabled:!0}),ee&&ee.length>0?ee.map((e=>(0,V.jsx)("option",{value:e.name,children:e.name},e._id))):(0,V.jsx)("option",{value:"",disabled:!0,children:"No Sources available"})]})]}),(0,V.jsxs)(n.ZP,{item:!0,xs:12,sm:1.5,children:[(0,V.jsx)(c.Z,{variant:"h6",component:"h6",style:{marginBottom:"-10px"},children:"Status"}),(0,V.jsxs)(i.Z,{fullWidth:!0,margin:"normal",name:"status",size:"small",select:!0,SelectProps:{native:!0},value:Ze,onChange:e=>{ye(e.target.value),(e=>{const t=oe.filter((t=>t.status===e));ke(t),console.log(t)})(e.target.value)},InputProps:{startAdornment:(0,V.jsx)(d.Z,{position:"start",children:(0,V.jsx)(g.Z,{})})},children:[(0,V.jsx)("option",{value:"",disabled:!0}),be&&be.length>0?be.map((e=>(0,V.jsx)("option",{value:e.name,children:e.name},e._id))):(0,V.jsx)("option",{value:"",disabled:!0,children:"No Status available"})]})]}),(null===W||void 0===W||null===(A=W.lead)||void 0===A?void 0:A.includes("read-all"))&&(0,V.jsxs)(n.ZP,{item:!0,xs:12,sm:1.5,children:[(0,V.jsx)(c.Z,{variant:"h6",component:"h6",style:{marginBottom:"-10px"},children:"Counselor"}),(0,V.jsxs)(i.Z,{fullWidth:!0,margin:"normal",name:"counselor",size:"small",select:!0,SelectProps:{native:!0},value:le,onChange:e=>{ce(e.target.value),console.log(e.target.value),(e=>{const t=oe.filter((t=>t.counsellor===e));ke(t),console.log(t)})(e.target.value)},InputProps:{startAdornment:(0,V.jsx)(d.Z,{position:"start",children:(0,V.jsx)(H.Z,{})})},children:[(0,V.jsx)("option",{value:"",disabled:!0}),Pe.concat(Be)&&Pe.concat(Be).length>0?Pe.concat(Be).map((e=>(0,V.jsx)("option",{value:e.label,children:e.label},e.id))):(0,V.jsx)("option",{value:"",disabled:!0,children:"No Counselors available"})]})]}),(0,V.jsxs)(n.ZP,{item:!0,xs:12,sm:1.5,children:[(0,V.jsx)(c.Z,{variant:"h6",component:"h6",style:{marginBottom:"-10px"},children:"Date From"}),(0,V.jsx)(i.Z,{fullWidth:!0,margin:"normal",name:"date",type:"date",size:"small",value:de,onChange:e=>{const t=e.target.value;ue(t),He(t,he)},InputLabelProps:{shrink:!0}})]}),(0,V.jsxs)(n.ZP,{item:!0,xs:12,sm:1.5,children:[(0,V.jsx)(c.Z,{variant:"h6",component:"h6",style:{marginBottom:"-10px"},children:"Date To"}),(0,V.jsx)(i.Z,{fullWidth:!0,margin:"normal",name:"date",type:"date",size:"small",value:he,onChange:e=>{const t=e.target.value;me(t),He(de,t)}})]}),(0,V.jsx)(n.ZP,{style:{marginTop:"30px"},item:!0,xs:12,sm:.5,children:(0,V.jsx)(C.Z,{variant:"contained",color:"error",sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px"},onClick:()=>{se(""),ie(""),ce(""),ue(""),me(""),pe(""),ye(""),ke(oe)},children:(0,V.jsx)(F.Z,{sx:{fontSize:"18px"}})})})]})}),(0,V.jsx)(n.ZP,{container:!0,sx:{marginTop:"2px"},alignItems:"flex-start",spacing:Y?0:2,children:(0,V.jsx)(n.ZP,{alignItems:"flex-start",item:!0,xs:12,sm:12,children:!xe&&(0,V.jsx)(J,{rows:_e,rowHeight:40,columns:Oe,getRowClassName:e=>e.indexRelativeToCurrentPage%2===0?"even":"odd",onRowClick:(e,t)=>{const o=t.target.closest(".MuiDataGrid-cell").getAttribute("data-field");console.log(e),console.log(o),"sms"===o?(e=>{je({type:"sendEmail",data:e.row}),console.log(e.row)})(e):"counsellor"!==o&&"edit"!==o&&(e=>{je({type:"leadDetails",data:e.row}),console.log(e.row)})(e)},initialState:{pagination:{paginationModel:{page:0,pageSize:25}}},getRowId:e=>e.id,getRowStyle:e=>({backgroundColor:e.index%2===0?"#fff":"#f0f8ff"}),pageSizeOptions:[10,25,100],checkboxSelection:!0,onRowSelectionModelChange:e=>{Ce(e)}})})})]}),(0,V.jsx)(T.Z,{isOpen:ve&&"leadDetails"===ve.type,onClose:()=>je(null),leadDetails:ve?ve.data:null}),(0,V.jsx)(B.Z,{isOpen:ve&&"sendEmail"===ve.type,onClose:()=>je(null),leadDetails:ve?ve.data:null})]})]})})}},5211:function(e,t,o){var r=o(4836);t.Z=void 0;var n=r(o(5045)),s=o(6417),a=(0,n.default)((0,s.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");t.Z=a},4090:function(e,t,o){var r=o(4836);t.Z=void 0;var n=r(o(5045)),s=o(6417),a=(0,n.default)((0,s.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"}),"Assignment");t.Z=a},3587:function(e,t,o){var r=o(4836);t.Z=void 0;var n=r(o(5045)),s=o(6417),a=(0,n.default)([(0,s.jsx)("path",{d:"M6.32 13.01c.96.02 1.85.5 2.45 1.34C9.5 15.38 10.71 16 12 16s2.5-.62 3.23-1.66c.6-.84 1.49-1.32 2.45-1.34-.72-1.22-3.6-2-5.68-2-2.07 0-4.96.78-5.68 2.01zM4 13c1.66 0 3-1.34 3-3S5.66 7 4 7s-3 1.34-3 3 1.34 3 3 3zm16 0c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3zm-8-3c1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3 1.34 3 3 3z"},"0"),(0,s.jsx)("path",{d:"M21 14h-3.27c-.77 0-1.35.45-1.68.92-.04.06-1.36 2.08-4.05 2.08-1.43 0-3.03-.64-4.05-2.08-.39-.55-1-.92-1.68-.92H3c-1.1 0-2 .9-2 2v4h7v-2.26c1.15.8 2.54 1.26 4 1.26s2.85-.46 4-1.26V20h7v-4c0-1.1-.9-2-2-2z"},"1")],"Diversity3");t.Z=a},8406:function(e,t,o){var r=o(4836);t.Z=void 0;var n=r(o(5045)),s=o(6417),a=(0,n.default)((0,s.jsx)("path",{d:"M19.79 5.61C20.3 4.95 19.83 4 19 4H6.83l7.97 7.97 4.99-6.36zM2.81 2.81 1.39 4.22 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-2.17l5.78 5.78 1.41-1.41L2.81 2.81z"}),"FilterAltOff");t.Z=a},5927:function(e,t,o){var r=o(4836);t.Z=void 0;var n=r(o(5045)),s=o(6417),a=(0,n.default)((0,s.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"}),"InsertLink");t.Z=a},297:function(e,t,o){var r=o(4836);t.Z=void 0;var n=r(o(5045)),s=o(6417),a=(0,n.default)((0,s.jsx)("path",{d:"M6 13c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm6-10C9.8 3 8 4.8 8 7s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm6 10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4z"}),"Workspaces");t.Z=a}}]);