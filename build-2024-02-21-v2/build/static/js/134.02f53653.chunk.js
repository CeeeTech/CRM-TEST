"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[134],{293:function(e,t,o){o.r(t),o.d(t,{default:function(){return M}});var r=o(7313),s=o(4631),a=o(9019),n=o(3497),i=o(4813),l=o(8119),d=o(1113),c=o(1727),u=o(1405),m=o(6104),p=o(1095),h=o(4149),g=o(9860),f=o(3463),v=o(1271),x=o(4156);var b=(0,o(7430).Z)("MuiBox",["root"]);var Z=(0,x.Z)({defaultClassName:b.root,generateClassName:v.Z.generate}),y=o(9153),j=o(6287),w=o(7122),S=o(1163),C=o(9429),$=o(659),k=o(7114),P=o.n(k),_=o(1399),E=o.n(_),T=o(7890),B=o(3650),N=(o(6029),o(1746)),I=o(7227),O=o(4859),F=o(3127),L=o(6417);const A={customNode:B.Z};function M(){const[e,t,o]=(0,N.Rr)([]),[v,x,b]=(0,N.ll)([[]]),k=(0,r.useCallback)((e=>x((t=>(0,N.Z_)(e,t)))),[x]),{logout:_}=(0,$.a)(),B=(new Date).toISOString().split("T")[0],M=(0,g.Z)(),{user:R}=(0,w.E)(),z=(0,i.Z)(M.breakpoints.down("md")),U=(0,T.s0)(),[V,G]=(0,r.useState)([]),[H,D]=(0,r.useState)(!0),q=new URLSearchParams(window.location.search).get("id"),W=E()(P().mixin({toast:!0,position:"bottom-end",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:3500,timerProgressBar:!0})),[J,K]=(0,r.useState)({name:"",dob:"",email:"",nic:"",contact_no:"",address:"",date:B,scheduled_to:"",course:"Select Course",branch:"Select Branch",status:"Select Status",comment:"",followupId:""});(0,r.useEffect)((()=>{console.log(J.status),(async()=>{try{const e=await fetch(j.Z.apiUrl+"api/status",{method:"GET",headers:{Authorization:`Bearer ${R.token}`}});if(!e.ok){if(401===res.status)console.error("Unauthorized access. Logging out."),_();else{if(500===res.status)return console.error("Internal Server Error."),void _();console.error("Error fetching  status:",e.statusText)}return}{const t=(await e.json()).filter((e=>"New"!==e.name));console.log(t),console.log(t),G(t)}}catch(e){console.error("Error fetching status:",e.message)}})(),(async()=>{try{const e=await fetch(j.Z.apiUrl+`api/followups/by-lead/${q}`,{method:"GET",headers:{Authorization:`Bearer ${R.token}`}});if(!e.ok){if(console.error("Error fetching followup:",e.statusText),401===res.status)console.error("Unauthorized access. Logging out."),_();else{if(500===res.status)return console.error("Internal Server Error."),void _();console.error("Error fetching lead data:",e.statusText)}return}{const o=await e.json();console.log("followup data",o);const r=o.map(((e,t)=>{let o,r,s,a;t%4==0&&(o=150,r=t/4*150,s="right",a="top"),t%4==1&&(o=450,r=(t-1)/4*150,s="right",a="left"),t%4==2&&(o=750,r=(t-2)/4*150,s="right",a="left"),t%4==3&&(o=1050,r=(t-3)/4*150,s="bottom",a="left"),r+=50;let n="#e6e3e3";return"New"==e.status&&(n="#c7dbff"),"Dropped"!=e.status&&"Fake"!=e.status||(n="#ffc7d0"),"Duplicate"==e.status&&(n="#fcbca7"),"Registered"==e.status&&(n="#c4ffc2"),"Next intake"==e.status&&(n="#fff2d1"),{id:t.toString(),sourcePosition:s,targetPosition:a,position:{x:o,y:r},type:"customNode",data:{label:e.status,comment:e.date,color:n},handle:{x:.5,y:1}}})),s=o.map(((e,t)=>({id:`e${t}-${t+1}`,source:t.toString(),type:"smoothstep",animated:!0,target:(t+1).toString()})));t(r),x(s)}}catch(e){console.error("Error fetching followup:",e.message)}})(),q&&(D(!0),(async()=>{try{const e=await fetch(j.Z.apiUrl+`api/leads/${q}`,{method:"GET",headers:{Authorization:`Bearer ${R.token}`}});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),_();else{if(500===e.status)return console.error("Internal Server Error."),void _();console.error("Error fetching lead data:",e.statusText)}return}{const t=await e.json();K(t),console.log(t),console.log("Lead data:",t)}}catch(e){console.error("Error fetching lead data:",e.message)}finally{D(!1)}})())}),[]);return(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(n.Z,{title:"Add Followup",children:H?(0,L.jsx)(h.Z,{}):(0,L.jsx)(C.J9,{initialValues:{name:(null===J||void 0===J?void 0:J.name)||"",nic:(null===J||void 0===J?void 0:J.nic)||"",address:(null===J||void 0===J?void 0:J.address)||"",contact_no:(null===J||void 0===J?void 0:J.contact_no)||"",email:(null===J||void 0===J?void 0:J.email)||"",course:(null===J||void 0===J?void 0:J.course)||"",date:(null===J||void 0===J?void 0:J.date)||"",branch:(null===J||void 0===J?void 0:J.branch)||"",dob:(null===J||void 0===J?void 0:J.dob)||"",scheduled_to:(null===J||void 0===J?void 0:J.scheduled_to)||"",status:(null===J||void 0===J?void 0:J.status)||"",comment:(null===J||void 0===J?void 0:J.comment)||""},validationSchema:f.Ry().shape({comment:f.Z_().when("status",{is:"Dropped",then:f.Z_().required("Comment is required when status is Dropped")})}),onSubmit:async(e,t)=>{let{setSubmitting:o,setFieldError:r}=t;console.log(e.status);try{if(void 0!=e.status&&e.status){if("Dropped"===e.status&&!e.comment.trim())return void r("comment","Comment is required for Dropped status");const t={user_id:null===R||void 0===R?void 0:R._id,lead_id:q,status:e.status,comment:e.comment},o=await fetch(j.Z.apiUrl+"api/followUps",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R.token}`},body:JSON.stringify(t)});if(!o.ok){if(401===o.status)console.error("Unauthorized access. Logging out."),_();else{if(500===o.status)return console.error("Internal Server Error."),void _();console.error("Error adding followup:",o.statusText),W.fire({icon:"error",title:"Error Adding Followup."})}return}console.log("update followup"),W.fire({icon:"success",title:"Followup Added Successfully."}),U("/app/leads")}K({status:"",comment:""})}catch(s){console.error("Error during lead update:",s.message),W.fire({icon:"error",title:"Error Updating Lead."}),r("submit",s.message)}finally{o(!1)}},children:t=>{let{errors:r,handleBlur:n,handleChange:i,handleSubmit:h,isSubmitting:g,values:f,touched:x}=t;return(0,L.jsxs)("div",{children:[(0,L.jsx)("form",{autoComplete:"off",noValidate:!0,onSubmit:h,children:(0,L.jsx)(a.ZP,{container:!0,direction:"column",justifyContent:"center",children:(0,L.jsx)(a.ZP,{container:!0,sx:{p:3},spacing:z?0:2,children:(0,L.jsx)(a.ZP,{item:!0,xs:12,sm:12,children:(0,L.jsxs)(a.ZP,{container:!0,alignItems:"center",spacing:2,children:[(0,L.jsx)(a.ZP,{item:!0,children:(0,L.jsx)(l.Z,{children:(0,L.jsx)(S.Z,{})})}),(0,L.jsxs)(a.ZP,{item:!0,xs:2,sm:2,children:[(0,L.jsx)(d.Z,{variant:"h3",children:f.name}),(0,L.jsx)(d.Z,{variant:"h5",color:"textSecondary",children:f.course})]}),(0,L.jsx)(a.ZP,{item:!0,xs:6,sm:1.5,children:(0,L.jsx)(Z,{sx:{mt:3,mb:2}})}),q?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(a.ZP,{sx:{ml:10},item:!0,xs:6,sm:2,children:[(0,L.jsx)(d.Z,{variant:"h5",component:"h5",children:"Select Status"}),(0,L.jsxs)(s.Z,{fullWidth:!0,margin:"normal",name:"status",select:!0,value:f.status,onChange:i,InputProps:{startAdornment:(0,L.jsx)(c.Z,{position:"start",children:(0,L.jsx)(y.Z,{})})},children:[(0,L.jsx)(u.Z,{value:"",children:"Select a Status"}),V.map((e=>(0,L.jsx)(u.Z,{value:e.name,children:e.name},e._id)))]})]}),(0,L.jsxs)(a.ZP,{item:!0,xs:12,sm:3,children:[(0,L.jsx)(d.Z,{variant:"h5",component:"h5",children:"Comment"}),(0,L.jsx)(s.Z,{fullWidth:!0,margin:"normal",name:"comment",type:"text",onBlur:n,value:f.comment,onChange:i,error:Boolean(x.comment&&r.comment),helperText:x.comment&&r.comment})]}),(0,L.jsx)(a.ZP,{item:!0,xs:12,sm:2,children:(0,L.jsx)(m.Z,{sx:{mt:3},children:(0,L.jsx)(p.Z,{variant:"contained",type:"submit",disabled:g,children:"Add follow up"})})})]}):(0,L.jsx)(L.Fragment,{})]})})})})}),(0,L.jsx)("div",{style:{width:"100%",height:"100vh"},children:(0,L.jsxs)(N.x$,{nodes:e,edges:v,onNodesChange:o,onEdgesChange:b,onConnect:k,nodeTypes:A,children:[(0,L.jsx)(I.Z,{}),(0,L.jsx)(O.a,{}),(0,L.jsx)(F.A,{variant:"dots",gap:12,size:1})]})})]})}})})})}},3650:function(e,t,o){var r=o(7313),s=o(1746),a=o(9224),n=o(6417);const i=a.ZP.div`
  padding: 10px 20px;
  border-radius: 5px;
  background: ${e=>e.theme.nodeBg};
  color: ${e=>e.theme.nodeColor};
  border: 1px solid ${e=>e.selected?e.theme.primary:e.theme.nodeBorder};

  .react-flow__handle {
    background: ${e=>e.theme.primary};
    width: 8px;
    height: 10px;
    border-radius: 5px;
  }
`;t.Z=(0,r.memo)((e=>{let{data:t,selected:o}=e;return(0,n.jsx)("div",{style:{backgroundColor:t.color,borderRadius:"5px"},children:(0,n.jsxs)(i,{selected:o,children:[(0,n.jsx)(s.HH,{type:"target",position:s.Ly.Left}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:t.label}),(0,n.jsx)("p",{style:{marginTop:"-2px"},children:t.comment})]}),(0,n.jsx)(s.HH,{type:"source",position:s.Ly.Right})]})})}))},9153:function(e,t,o){var r=o(4836);t.Z=void 0;var s=r(o(5045)),a=o(6417),n=(0,s.default)((0,a.jsx)("path",{d:"m6 2 .01 6L10 12l-3.99 4.01L6 22h12v-6l-4-4 4-3.99V2H6zm10 14.5V20H8v-3.5l4-4 4 4z"}),"HourglassTop");t.Z=n},6104:function(e,t,o){o.d(t,{Z:function(){return f}});var r=o(3366),s=o(7462),a=o(7313),n=o(2197),i=o(1921),l=o(7592),d=o(7342),c=o(7430),u=o(2298);function m(e){return(0,u.ZP)("MuiCardActions",e)}(0,c.Z)("MuiCardActions",["root","spacing"]);var p=o(6417);const h=["disableSpacing","className"],g=(0,l.ZP)("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,!o.disableSpacing&&t.spacing]}})((e=>{let{ownerState:t}=e;return(0,s.Z)({display:"flex",alignItems:"center",padding:8},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})}));var f=a.forwardRef((function(e,t){const o=(0,d.Z)({props:e,name:"MuiCardActions"}),{disableSpacing:a=!1,className:l}=o,c=(0,r.Z)(o,h),u=(0,s.Z)({},o,{disableSpacing:a}),f=(e=>{const{classes:t,disableSpacing:o}=e,r={root:["root",!o&&"spacing"]};return(0,i.Z)(r,m,t)})(u);return(0,p.jsx)(g,(0,s.Z)({className:(0,n.Z)(f.root,l),ownerState:u,ref:t},c))}))},1405:function(e,t,o){o.d(t,{Z:function(){return C}});var r=o(3366),s=o(7462),a=o(7313),n=o(2197),i=o(1921),l=o(7551),d=o(7592),c=o(7342),u=o(1195),m=o(5272),p=o(4993),h=o(6983),g=o(9273),f=o(7363),v=o(1081),x=o(7430),b=o(2298);function Z(e){return(0,b.ZP)("MuiMenuItem",e)}var y=(0,x.Z)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),j=o(6417);const w=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],S=(0,d.ZP)(m.Z,{shouldForwardProp:e=>(0,d.FO)(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.dense&&t.dense,o.divider&&t.divider,!o.disableGutters&&t.gutters]}})((e=>{let{theme:t,ownerState:o}=e;return(0,s.Z)({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!o.disableGutters&&{paddingLeft:16,paddingRight:16},o.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${y.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,l.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${y.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:(0,l.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${y.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:(0,l.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:(0,l.Fq)(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${y.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${y.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${g.Z.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${g.Z.inset}`]:{marginLeft:52},[`& .${v.Z.root}`]:{marginTop:0,marginBottom:0},[`& .${v.Z.inset}`]:{paddingLeft:36},[`& .${f.Z.root}`]:{minWidth:36}},!o.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},o.dense&&(0,s.Z)({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${f.Z.root} svg`]:{fontSize:"1.25rem"}}))}));var C=a.forwardRef((function(e,t){const o=(0,c.Z)({props:e,name:"MuiMenuItem"}),{autoFocus:l=!1,component:d="li",dense:m=!1,divider:g=!1,disableGutters:f=!1,focusVisibleClassName:v,role:x="menuitem",tabIndex:b,className:y}=o,C=(0,r.Z)(o,w),$=a.useContext(u.Z),k=a.useMemo((()=>({dense:m||$.dense||!1,disableGutters:f})),[$.dense,m,f]),P=a.useRef(null);(0,p.Z)((()=>{l&&P.current&&P.current.focus()}),[l]);const _=(0,s.Z)({},o,{dense:k.dense,divider:g,disableGutters:f}),E=(e=>{const{disabled:t,dense:o,divider:r,disableGutters:a,selected:n,classes:l}=e,d={root:["root",o&&"dense",t&&"disabled",!a&&"gutters",r&&"divider",n&&"selected"]},c=(0,i.Z)(d,Z,l);return(0,s.Z)({},l,c)})(o),T=(0,h.Z)(P,t);let B;return o.disabled||(B=void 0!==b?b:-1),(0,j.jsx)(u.Z.Provider,{value:k,children:(0,j.jsx)(S,(0,s.Z)({ref:T,role:x,tabIndex:B,component:d,focusVisibleClassName:(0,n.Z)(E.focusVisible,v),className:(0,n.Z)(E.root,y)},C,{ownerState:_,classes:E}))})}))}}]);