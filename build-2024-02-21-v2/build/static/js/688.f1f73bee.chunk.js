"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[688],{9780:function(e,t,o){var r=o(7313),n=o(6149),s=o(3604),i=o(9019),a=o(8119),l=o(1113),c=o(2247),d=o(6467),u=o(9536),h=o(4117),g=o(1095),m=o(1163),x=o(647),p=o(483),f=o(9632),j=o(6937),w=o(5091),v=o(4676),Z=o(2639),b=o(4180),y=o(6863),_=o(6287),C=o(7122),S=o(659),k=o(4149),E=(o(6029),o(1746)),L=o(7227),P=o(4859),A=o(3127),T=o(3650),z=o(6417);const D={customNode:T.Z};t.Z=e=>{let{isOpen:t,onClose:o,leadDetails:T}=e;const[N,B]=(0,r.useState)(!1),{user:R}=(0,C.E)(),{logout:O}=(0,S.a)(),[$,U,W]=(0,E.Rr)([]),[F,I,H]=(0,E.ll)([[]]),M=(0,r.useCallback)((e=>I((t=>(0,E.Z_)(e,t)))),[I]);(0,r.useEffect)((()=>{(async()=>{try{if(B(!0),!T)return;const e=await fetch(_.Z.apiUrl+`api/followups/by-lead/${T.id}`,{method:"GET",headers:{Authorization:`Bearer ${R.token}`}});if(e.ok){const t=await e.json();console.log("followup data",t);const o=t.map(((e,t)=>{let o,r,n,s;t%3==0&&(o=150,r=t/3*100,n="right",s="top"),t%3==1&&(o=350,r=(t-1)/3*100,n="right",s="left"),t%3==2&&(o=550,r=(t-2)/3*100,n="bottom",s="left"),r+=50;let i="#e6e3e3";return"New"==e.status&&(i="#c7dbff"),"Dropped"!=e.status&&"Fake"!=e.status||(i="#ffc7d0"),"Duplicate"==e.status&&(i="#fcbca7"),"Registered"==e.status&&(i="#c4ffc2"),"Next intake"==e.status&&(i="#fff2d1"),{id:t.toString(),sourcePosition:n,targetPosition:s,position:{x:o,y:r},type:"customNode",data:{label:e.status,comment:e.date,color:i},handle:{x:.5,y:1}}})),r=t.map(((e,t)=>({id:`e${t}-${t+1}`,source:t.toString(),type:"smoothstep",animated:!0,target:(t+1).toString()})));U(o),I(r)}else console.error("Error fetching followup:",e.statusText),401===e.status?(console.error("Unauthorized access. Logging out."),O()):console.error("Error fetching lead data:",e.statusText)}catch(e){console.error("Error fetching followup:",e.message)}finally{B(!1)}})()}),[T]);const G=()=>{o()};return T?(0,z.jsxs)(n.Z,{open:t,onClose:G,fullWidth:!0,maxWidth:"md",children:[(0,z.jsx)(s.Z,{children:(0,z.jsxs)(i.ZP,{container:!0,alignItems:"center",spacing:2,children:[(0,z.jsx)(i.ZP,{item:!0,children:(0,z.jsx)(a.Z,{children:(0,z.jsx)(m.Z,{})})}),(0,z.jsxs)(i.ZP,{item:!0,children:[(0,z.jsx)(l.Z,{variant:"h3",children:T.name}),(0,z.jsxs)(l.Z,{variant:"h5",color:"textSecondary",children:[T.branch," | ",T.course]})]})]})}),(0,z.jsx)(c.Z,{sx:{mt:3,mb:2}}),(0,z.jsx)(d.Z,{children:(0,z.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,z.jsxs)(i.ZP,{item:!0,xs:12,sm:6,children:[(0,z.jsx)(u.Z,{mb:2,children:(0,z.jsx)(l.Z,{variant:"h4",children:"Student Details"})}),q("Location",T.address,(0,z.jsx)(x.Z,{})),q("NIC",T.nic,(0,z.jsx)(Z.Z,{})),q("Email",T.email,(0,z.jsx)(f.Z,{})),q("Phone",T.contact_no,(0,z.jsx)(j.Z,{})),q("DOB",T.dob,(0,z.jsx)(y.Z,{}))]}),(0,z.jsxs)(i.ZP,{item:!0,xs:12,sm:6,children:[(0,z.jsx)(u.Z,{mb:2,children:(0,z.jsx)(l.Z,{variant:"h4",children:"Other Details"})}),q("Course",T.course,(0,z.jsx)(p.Z,{})),q("Branch",T.branch,(0,z.jsx)(v.Z,{})),q("Counsellor",T.counsellor,(0,z.jsx)(m.Z,{})),q("Status",T.status,(0,z.jsx)(w.Z,{})),q("Source",T.source,(0,z.jsx)(b.Z,{}))]}),(0,z.jsxs)(i.ZP,{item:!0,xs:12,children:[(0,z.jsx)(u.Z,{mb:2,children:(0,z.jsx)(l.Z,{variant:"h4",children:"Follow-up History"})}),N?(0,z.jsx)(k.Z,{}):(0,z.jsx)("div",{style:{width:"100%",height:"50vh"},children:(0,z.jsxs)(E.x$,{nodes:$,edges:F,onNodesChange:W,onEdgesChange:H,onConnect:M,nodeTypes:D,children:[(0,z.jsx)(L.Z,{}),(0,z.jsx)(P.a,{}),(0,z.jsx)(A.A,{variant:"dots",gap:12,size:1})]})})]})]})}),(0,z.jsx)(c.Z,{sx:{mt:3,mb:2}}),(0,z.jsx)(h.Z,{children:(0,z.jsx)(g.Z,{onClick:G,color:"primary",children:"Close"})})]}):null;function q(e,t,o){if("DOB"===e&&t){t=new Date(t).toLocaleDateString()}return(0,z.jsx)(u.Z,{sx:{marginBottom:1},children:(0,z.jsxs)(l.Z,{variant:"body1",display:"flex",alignItems:"center",children:[o&&(0,z.jsx)("span",{style:{marginRight:"8px"},children:o}),(0,z.jsxs)("span",{children:[e,":"]}),"\xa0\xa0",t]})})}}},3650:function(e,t,o){var r=o(7313),n=o(1746),s=o(9224),i=o(6417);const a=s.ZP.div`
  padding: 10px 20px;
  border-radius: 5px;
  background: ${e=>e.theme.nodeBg};
  color: ${e=>e.theme.nodeColor};
  border: 1px solid ${e=>e.selected?e.theme.primary:e.theme.nodeBorder};

  .react-flow__handle {
    background: ${e=>e.theme.primary};
    width: 8px;
    height: 10px;
    border-radius: 5px;
  }
`;t.Z=(0,r.memo)((e=>{let{data:t,selected:o}=e;return(0,i.jsx)("div",{style:{backgroundColor:t.color,borderRadius:"5px"},children:(0,i.jsxs)(a,{selected:o,children:[(0,i.jsx)(n.HH,{type:"target",position:n.Ly.Left}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:t.label}),(0,i.jsx)("p",{style:{marginTop:"-2px"},children:t.comment})]}),(0,i.jsx)(n.HH,{type:"source",position:n.Ly.Right})]})})}))},7208:function(e,t,o){o.r(t),o.d(t,{default:function(){return W}});var r=o(7313),n=o(9019),s=o(3497),i=o(4813),a=o(4631),l=o(5281),c=o(1113),d=o(1727),u=o(9860),h=o(40),g=o(8370),m=o(5769),x=o(8832),p=o(1997),f=o(8623),j=o(8975),w=o(7983),v=o(1095),Z=o(7890),b=o(7122),y=o(4149),_=o(6287),C=o(659),S=o(9780),k=o(1689),E=o(7114),L=o.n(E),P=o(1399),A=o.n(P),T=o(7592),z=o(7551),D=o(430),N=o(7841),B=o(5551),R=o(7030),O=o(6417);const $=.2,U=(0,T.ZP)(D._$)((e=>{let{theme:t}=e;return{[`& .${N._.row}.even`]:{backgroundColor:t.palette.grey[200],"&:hover, &.Mui-hovered":{backgroundColor:(0,z.Fq)(t.palette.primary.main,$),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,z.Fq)(t.palette.primary.main,$+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,z.Fq)(t.palette.primary.main,$+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,z.Fq)(t.palette.primary.main,$+t.palette.action.selectedOpacity)}}}}}}));function W(){var e,t;const{logout:o}=(0,C.a)(),{user:E}=(0,b.E)(),{permissions:P}=E||{},{userType:T}=E||{},z=(0,Z.s0)(),D=(0,u.Z)(),N=(0,i.Z)(D.breakpoints.down("md")),$={facebook:(0,O.jsx)(h.Z,{color:"primary",style:{color:"blue"}}),manual:(0,O.jsx)(m.Z,{color:"primary",style:{color:"green"}}),internal:(0,O.jsx)(g.Z,{color:"primary",style:{color:"orange"}})},[W,F]=(0,r.useState)(!0),[I,H]=(0,r.useState)(!1),[M,G]=(0,r.useState)([]),[q,J]=(0,r.useState)([]),[Y,K]=(0,r.useState)([]),[Q,V]=(0,r.useState)(null),[X,ee]=(0,r.useState)(""),[te,oe]=(0,r.useState)([]),[re,ne]=(0,r.useState)([]),se=["admin","sup_admin","gen_supervisor"].includes(null===T||void 0===T?void 0:T.name),ie=A()(L().mixin({toast:!0,position:"bottom-end",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:3500,timerProgressBar:!0})),ae=()=>{ie.fire({icon:"error",title:"Error Occured While Deleting Leads."})},le=new URLSearchParams(window.location.search).get("status"),ce=[{field:"source",headerName:"",width:10,align:"center",renderCell:e=>(0,O.jsx)(k.Z,{title:e.row.source,arrow:!0,children:$[e.row.source]})},{field:"reference_number",headerName:"#",align:"center",width:55,headerAlign:"center"},{field:"date",headerName:"Date",flex:0,width:100,minWidth:50},{field:"name",headerName:"Student Name",flex:.5,width:100,minWidth:150},{field:"contact_no",headerName:"Contact No",flex:1,width:100,minWidth:150},{field:"status",headerName:"Status",flex:1,width:100,minWidth:150},{field:"course_code",headerName:"Course",flex:.5,width:100,minWidth:50},{field:"counsellor",headerName:"Assign To",description:"This column has a value getter and is not sortable.",sortable:!1,flex:1,width:100,minWidth:150,align:"left",renderCell:e=>se?(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(f.Z,{disablePortal:!0,id:"combo-box-demo",options:te.concat(re),sx:{width:200,my:2},renderInput:e=>(0,O.jsx)(a.Z,{...e,variant:"standard"}),value:e.row.counsellor,onChange:(t,r)=>{console.log("cid1",e.row.counsellor),console.log("cid",r.label),console.log("lid",e.row.id);const n=e.row.id,s=r.id;e.row.counsellor=r.label;(async()=>{try{const e=await fetch(_.Z.apiUrl+"api/counsellorAssignment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.token}`},body:JSON.stringify({counsellor_id:s,lead_id:n})});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),o();else{if(500===e.status)return console.error("Internal Server Error."),void o();console.error("Error updating lead data",e.statusText)}return}console.log(r.label),console.log("Successfully assigned"),ie.fire({icon:"success",title:"Assignment Successfull."})}catch(e){console.log(e),ie.fire({icon:"error",title:"Error While Assigning."})}})()}})}):(0,O.jsx)(O.Fragment,{children:e.row.counsellor?`Assigned to ${e.row.counsellor}`:"Pending"})},{field:"edit",headerName:"",description:"This column has a value getter and is not sortable.",sortable:!1,width:135,align:"right",renderCell:e=>{var t;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(v.Z,{variant:"contained",color:"primary",onClick:()=>{var t;t=e.row.id,console.log("clicked lead id",t),z("/app/leads/update?id="+t)},sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px"},children:(0,O.jsx)(x.Z,{sx:{fontSize:"18px"}})}),(null===P||void 0===P||null===(t=P.lead)||void 0===t?void 0:t.includes("delete"))&&(0,O.jsx)(v.Z,{variant:"contained",color:"error",onClick:()=>{handleSingleDelete(e.row.id)},style:{marginLeft:"5px"},sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px"},children:(0,O.jsx)(p.Z,{sx:{fontSize:"18px"}})}),"Registered"!=e.row.status&&"Fake"!=e.row.status&&"Duplicate"!=e.row.status&&"Dropped"!=e.row.status&&(0,O.jsx)(v.Z,{variant:"contained",color:"success",onClick:()=>{z("/app/leads/addfollowup?id="+e.row.id)},style:{marginLeft:"5px"},sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px",backgroundColor:"#039116"},children:(0,O.jsx)(B.Z,{sx:{fontSize:"18px",color:"white"}})}),("Registered"==e.row.status||"Fake"==e.row.status||"Duplicate"==e.row.status||"Dropped"==e.row.status)&&(0,O.jsx)(v.Z,{variant:"contained",color:"success",onClick:()=>{restorePrevious(e.row.id)},style:{marginLeft:"5px"},sx:{borderRadius:"50%",padding:"8px",minWidth:"unset",width:"32px",height:"32px",backgroundColor:"#d1bd0a"},children:(0,O.jsx)(R.Z,{sx:{fontSize:"18px",color:"white"}})})]})}}];async function de(){try{var e,t,r;const n=_.Z.apiUrl+"api/leads-details",s=await fetch(n,{method:"GET",headers:{Authorization:`Bearer ${E.token}`}});if(!s.ok){if(401===s.status)console.error("Unauthorized access. Logging out."),o();else{if(500===s.status)return console.error("Internal Server Error."),void o();console.error("Error fetching leads data",s.statusText)}return}let i=await s.json();if(console.log(i),i=i.map((e=>({reference_number:e.reference_number,id:e._id,date:e.date,scheduled_at:e.scheduled_at?e.scheduled_at:null,scheduled_to:e.scheduled_to?e.scheduled_to:null,name:e.student_id.name,contact_no:e.student_id.contact_no,address:e.student_id.address,dob:e.student_id.dob,email:e.student_id.email,nic:e.student_id.nic,course:e.course_id.name,course_code:ue(e.course_id.name),branch:e.branch_id.name,source:e.source_id?e.source_id.name:null,counsellor:e.assignment_id?e.assignment_id.counsellor_id.name:null,counsellor_id:e.assignment_id?e.assignment_id.counsellor_id._id:null,assigned_at:e.counsellorAssignment?e.counsellorAssignment.assigned_at:null,user_id:e.user_id?e.user_id:null,status:e.status_id?e.status_id.name:null}))),console.log(i),null!==P&&void 0!==P&&null!==(e=P.lead)&&void 0!==e&&e.includes("read-all")){if(le){const e=i.filter((e=>e.status===le));G(e),J(e),F(!1),console.log(le),console.log(e)}return void F(!1)}if(null!==P&&void 0!==P&&null!==(t=P.lead)&&void 0!==t&&t.includes("read")&&"counselor"===(null===T||void 0===T?void 0:T.name)){const e=i.filter((e=>e.counsellor_id===E._id));if(le){const t=e.filter((e=>e.status===le));G(t),J(e),F(!1)}return F(!1),void console.log(e)}if(null!==P&&void 0!==P&&null!==(r=P.lead)&&void 0!==r&&r.includes("read")&&"user"===(null===T||void 0===T?void 0:T.name)){const e=i.filter((e=>e.user_id===E._id));if(le){const t=e.filter((e=>e.status===le));G(t),J(e),F(!1)}return F(!1),void console.log(e)}F(!1)}catch(n){console.log("Error fetching leads:",n)}}(0,r.useEffect)((()=>{console.log(le),de(),async function(){try{const e=await fetch(_.Z.apiUrl+"api/getCounsellors",{method:"GET",headers:{Authorization:`Bearer ${E.token}`}});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),o();else{if(500===e.status)return console.error("Internal Server Error."),void o();console.error("Error fetching counselors:",e.statusText)}return}const t=await e.json();oe(t)}catch(e){console.log("Error fetching counselors:",e)}}(),async function(){try{const e=await fetch(_.Z.apiUrl+"api/getAdminCounselors",{method:"GET",headers:{Authorization:`Bearer ${E.token}`}});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),o();else{if(500===e.status)return console.error("Internal Server Error."),void o();console.error("Error fetching counselors:",e.statusText)}return}const t=await e.json();ne(t)}catch(e){console.log("Error fetching counselors:",e)}}()}),[]);const ue=e=>{if("other"===e.toLowerCase())return"Other";return e.split(" ").map((e=>e.replace(/[()]/g,"").charAt(0).toUpperCase())).join("")};return(0,O.jsx)(O.Fragment,{children:(0,O.jsxs)(s.Z,{title:le+" leads",isDeleting:I,arrIds:Y,buttonLabelDeleteAll:Y.length>1&&(null===P||void 0===P||null===(e=P.lead)||void 0===e?void 0:e.includes("delete-all"))&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(p.Z,{sx:{fontSize:"20px"}}),I?(0,O.jsx)(l.Z,{size:24,color:"inherit"}):(0,O.jsx)("span",{style:{marginLeft:"8px",fontWeight:"bold"},children:"Delete Leads"})]}),onButtonClickDeleteAll:()=>{Y.length>1?L().fire({title:"Are you sure?",text:"You will not be able to recover this file!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"No, keep it"}).then((e=>{e.isConfirmed&&async function(){H(!0);try{const e=await fetch(_.Z.apiUrl+"api/leads-archive",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E.token}`},body:JSON.stringify({ids:Y})});if(!e.ok){if(401===e.status)console.error("Unauthorized access. Logging out."),o();else{if(500===e.status)return console.error("Internal Server Error."),void o();console.error("Error fetching sources:",e.statusText),ae()}return}{const t=await e.json();console.log(t),F(!0),K([]),de(),ie.fire({icon:"success",title:"Leads Deleted Successfully."})}}catch(e){console.error("Error fetching sources:",e.message),ae()}finally{H(!1)}}()})):showErrorSwalNoLead()},buttonLabelExport:null!==P&&void 0!==P&&null!==(t=P.lead)&&void 0!==t&&t.includes("read-all")?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(j.Z,{style:{fontSize:"25px"}})," "]}):void 0,onButtonClickExport:()=>{const e=[],t=Object.keys(M[0]);e.push(t.join(","));for(const i of M){const o=t.map((e=>`"${(""+i[e]).replace(/"/g,'\\"')}"`));e.push(o.join(","))}const o=e.join("\n"),r=new Blob([o],{type:"text/csv"}),n=window.URL.createObjectURL(r),s=document.createElement("a");s.setAttribute("hidden",""),s.setAttribute("href",n),s.setAttribute("download","leads.csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s)},children:[W&&(0,O.jsx)(y.Z,{}),(0,O.jsxs)(n.ZP,{container:!0,direction:"column",justifyContent:"center",children:[(0,O.jsx)(n.ZP,{container:!0,direction:"column",children:(0,O.jsx)(n.ZP,{container:!0,spacing:N?0:2,children:(0,O.jsxs)(n.ZP,{item:!0,xs:12,sm:2.5,children:[(0,O.jsx)(c.Z,{variant:"h6",component:"h6",style:{marginBottom:"-10px"},children:"Search"}),(0,O.jsx)(a.Z,{fullWidth:!0,margin:"normal",name:"search",type:"text",size:"small",SelectProps:{native:!0},value:X,onChange:e=>{const{value:t}=e.target;ee(t),(e=>{const t=q.filter((t=>{const o=e.toLowerCase();return t.name&&t.name.toLowerCase().includes(o)||t.nic&&t.nic.toLowerCase().includes(o)||t.email&&t.email.toLowerCase().includes(o)||t.contact_no&&t.contact_no.toLowerCase().includes(o)}));G(t),console.log(t)})(t)},InputProps:{startAdornment:(0,O.jsx)(d.Z,{position:"start",children:(0,O.jsx)(w.Z,{})})}})]})})}),(0,O.jsx)(n.ZP,{container:!0,sx:{marginTop:"2px"},alignItems:"flex-start",spacing:N?0:2,children:(0,O.jsx)(n.ZP,{alignItems:"flex-start",item:!0,xs:12,sm:12,children:!W&&(0,O.jsx)(U,{rows:M,rowHeight:40,columns:ce,getRowClassName:e=>e.indexRelativeToCurrentPage%2===0?"even":"odd",onRowClick:(e,t)=>{const o=t.target.closest(".MuiDataGrid-cell").getAttribute("data-field");console.log(e),console.log(o),"counsellor"!=o&&"edit"!=o&&(e=>{V(e.row),console.log(e.row)})(e)},initialState:{pagination:{paginationModel:{page:0,pageSize:25}}},getRowId:e=>e.id,getRowStyle:e=>({backgroundColor:e.index%2===0?"#fff":"#f0f8ff"}),pageSizeOptions:[10,25,100],checkboxSelection:!0,onRowSelectionModelChange:e=>{K(e)}})})}),(0,O.jsx)(S.Z,{isOpen:!!Q,onClose:()=>V(null),leadDetails:Q})]})]})})}}}]);