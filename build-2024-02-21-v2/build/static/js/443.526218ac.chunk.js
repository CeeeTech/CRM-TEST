"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[443],{8443:function(e,r,s){s.r(r),s.d(r,{default:function(){return B}});var o=s(7313),n=s(4631),t=s(9019),a=s(3497),i=s(1113),l=s(1727),d=s(1405),c=s(3929),u=s(4758),m=s(2247),p=s(6104),h=s(1095),w=s(4149),f=s(9778),x=s(5504),y=s(9981),j=s(7898),v=s(6287),Z=s(9429),_=s(3463),g=s(659),T=s(7122),P=s(7114),S=s.n(P),U=s(1399),C=s.n(U),b=s(6417);function B(){const{logout:e}=(0,g.a)(),[r,s]=(0,o.useState)([]),[P,U]=(0,o.useState)(""),[B,A]=(0,o.useState)({}),[E,k]=(0,o.useState)(!0),{user:q}=(0,T.E)(),[I,$]=(0,o.useState)(!1),[z,N]=(0,o.useState)([]),[O,W]=(0,o.useState)([]),F=C()(S().mixin({toast:!0,position:"bottom-end",iconColor:"white",customClass:{popup:"colored-toast"},showConfirmButton:!1,timer:3500,timerProgressBar:!0})),D=()=>{F.fire({icon:"error",title:"Error While Saving Uesr Details."})},V=()=>{F.fire({icon:"error",title:"Error While Saving Uesr Password."})},G=new URLSearchParams(window.location.search).get("id");(0,o.useEffect)((()=>{(async()=>{try{const e=await fetch(v.Z.apiUrl+"api/user_types",{method:"GET",headers:{Authorization:`Bearer ${q.token}`}}),r=await e.json();s(r)}catch(e){console.error(e)}})(),(async()=>{try{const e=await fetch(v.Z.apiUrl+"api/courses",{method:"GET",headers:{Authorization:`Bearer ${q.token}`}}),r=await e.json();W(r)}catch(e){console.error(e)}})()}),[]),(0,o.useEffect)((()=>{G&&(async e=>{try{k(!0);const r=await fetch(v.Z.apiUrl+`api/users/${e}`,{method:"GET",headers:{Authorization:`Bearer ${q.token}`}}),s=await r.json();A(s),U(s.user_type)}catch(r){console.error("Error fetching user data:",r)}finally{k(!1)}})(G)}),[G]);const L=_.Ry({name:_.Z_().required("Name is required"),email:_.Z_().email("Invalid email address").required("Email is required"),userType:_.Z_().required("User Type is required"),selectedProductTypes:_.IX()}),R=_.Ry({new_password:_.Z_().min(5,"Password must be at least 5 characters").required("Password is required"),conform_password:_.Z_().oneOf([_.iH("new_password"),null],"Passwords must match").required("Confirm Password is required")}),H=(0,Z.TA)({initialValues:{name:B.name||"",email:B.email||"",userType:P||"",selectedProductTypes:z||[]},validationSchema:L,onSubmit:async r=>{console.log("Form values:",r);const s={name:r.name,email:r.email,userType:r.userType,product_type:z.join(", ")};console.log("Form data:",s);try{const r=G?v.Z.apiUrl+`api/update-user-byadmin/${G}`:v.Z.apiUrl+"api/users/add-new",o=await fetch(r,{method:G?"PATCH":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${q.token}`},body:JSON.stringify(s)});if(!o.ok){if(401===o.status)console.error("Unauthorized access. Logging out."),e();else{if(500===o.status)return console.error("Internal Server Error."),void e();D()}return}F.fire({icon:"success",title:"User Details Saved Successfully."}),console.log("Server response:",await o.json())}catch(o){console.error("Error submitting user details form:",o),D()}}}),J=(0,Z.TA)({initialValues:{new_password:"",conform_password:""},validationSchema:R,onSubmit:async r=>{if(!r.new_password||!r.conform_password)return void console.error("Both new password and confirm password are required.");if(r.new_password!==r.conform_password)return void console.error("Passwords do not match.");const s={password:r.new_password};try{const r=G?v.Z.apiUrl+`api/update-user-password/${G}`:v.Z.apiUrl+"api/users/add-new",o=await fetch(r,{method:G?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${q.token}`},body:JSON.stringify(s)});if(!o.ok){if(401===o.status)console.error("Unauthorized access. Logging out."),e();else{if(500===o.status)return console.error("Internal Server Error."),void e();V()}return}F.fire({icon:"success",title:"User Password Saved Successfully."}),console.log("Server response:",await o.json())}catch(o){console.error("Error submitting password form:",o),V()}}}),X=e=>{const{value:r}=e.target;N((e=>e.includes(r)?e.filter((e=>e!==r)):[...e,r])),H.setValues((e=>({...e,selectedProductTypes:prevSelectedProductTypes.includes(r)?prevSelectedProductTypes.filter((e=>e!==r)):[...prevSelectedProductTypes,r]})))};return(0,o.useEffect)((()=>{H.setValues({name:B.name||"",email:B.email||"",userType:P||"",selectedProductTypes:z||[]});const e=r.find((e=>"counselor"===e.name)),s=r.find((e=>"admin_counselor"===e.name)),o=P===(null===e||void 0===e?void 0:e._id)||P===(null===s||void 0===s?void 0:s._id);if($(o),B.product_type){const e=B.product_type.split(",").map((e=>e.trim()));N(e)}else N([])}),[B,P]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a.Z,{title:G?"Update User":"Add New User",children:E?(0,b.jsx)(w.Z,{}):(0,b.jsx)("form",{onSubmit:H.handleSubmit,children:(0,b.jsxs)(t.ZP,{container:!0,direction:"column",justifyContent:"center",children:[(0,b.jsx)(t.ZP,{container:!0,spacing:2,children:(!G||Object.keys(B).length>0&&!E)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(t.ZP,{item:!0,xs:12,sm:6,children:[(0,b.jsx)(i.Z,{variant:"h5",component:"h5",children:"Name"}),(0,b.jsx)(n.Z,{fullWidth:!0,margin:"normal",name:"name",type:"text",value:H.values.name,onChange:H.handleChange,onBlur:H.handleBlur,error:H.touched.name&&Boolean(H.errors.name),helperText:H.touched.name&&H.errors.name,InputProps:{startAdornment:(0,b.jsx)(l.Z,{position:"start",children:(0,b.jsx)(f.Z,{})})}})]}),(0,b.jsxs)(t.ZP,{item:!0,xs:12,sm:6,children:[(0,b.jsx)(i.Z,{variant:"h5",component:"h5",children:"Email"}),(0,b.jsx)(n.Z,{fullWidth:!0,margin:"normal",name:"email",type:"email",value:H.values.email,onChange:H.handleChange,onBlur:H.handleBlur,error:H.touched.email&&Boolean(H.errors.email),helperText:H.touched.email&&H.errors.email,InputProps:{startAdornment:(0,b.jsx)(l.Z,{position:"start",children:(0,b.jsx)(x.Z,{})})}})]}),(0,b.jsxs)(t.ZP,{item:!0,xs:12,sm:6,children:[(0,b.jsx)(i.Z,{variant:"h5",component:"h5",children:"User Type"}),(0,b.jsxs)(n.Z,{fullWidth:!0,margin:"normal",name:"userType",select:!0,value:H.values.userType,onChange:e=>{H.handleChange(e);const s=r.find((e=>"counselor"===e.name)),o=r.find((e=>"admin_counselor"===e.name));console.log("Selected User Type ID:",e.target.value),console.log("Counselor User Type ID:",null===s||void 0===s?void 0:s._id);const n=e.target.value===(null===s||void 0===s?void 0:s._id)||e.target.value===(null===o||void 0===o?void 0:o._id);$(n)},onBlur:H.handleBlur,error:H.touched.userType&&Boolean(H.errors.userType),helperText:H.touched.userType&&H.errors.userType,InputProps:{startAdornment:(0,b.jsx)(l.Z,{position:"start",children:(0,b.jsx)(y.Z,{})})},children:[(0,b.jsx)(d.Z,{value:"",children:"Select User Type"}),r.map((e=>(0,b.jsx)(d.Z,{value:e._id,children:e.name},e._id)))]})]}),I&&(0,b.jsxs)(t.ZP,{item:!0,xs:12,sm:6,children:[(0,b.jsx)(i.Z,{variant:"h5",component:"h5",children:"Product Type"}),O.map((e=>(0,b.jsx)(c.Z,{control:(0,b.jsx)(u.Z,{checked:z.includes(e._id),onChange:X,value:e._id}),label:e.name,sx:{marginBottom:"10px",display:"block"}},e._id)))]})]})}),(0,b.jsx)(m.Z,{sx:{mt:3,mb:2}}),(0,b.jsx)(p.Z,{sx:{justifyContent:"flex-end"},children:(0,b.jsx)(h.Z,{variant:"contained",type:"submit",children:G?"Update User":"Add User"})})]})})}),(0,b.jsx)("div",{style:{marginTop:"20px"}}),(0,b.jsx)(a.Z,{title:G?"Update Password":"Add New User",children:(0,b.jsx)("form",{onSubmit:J.handleSubmit,children:(0,b.jsxs)(t.ZP,{container:!0,direction:"column",justifyContent:"center",children:[(0,b.jsx)(t.ZP,{container:!0,spacing:2,children:(!G||Object.keys(B).length>0&&!E)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(t.ZP,{item:!0,xs:12,sm:6,children:[(0,b.jsx)(i.Z,{variant:"h5",component:"h5",children:"New Password"}),(0,b.jsx)(n.Z,{fullWidth:!0,margin:"normal",name:"new_password",type:"password",value:J.values.new_password,onChange:J.handleChange,onBlur:J.handleBlur,error:J.touched.new_password&&Boolean(J.errors.new_password),helperText:J.touched.new_password&&J.errors.new_password,InputProps:{startAdornment:(0,b.jsx)(l.Z,{position:"start",children:(0,b.jsx)(j.Z,{})})}})]}),(0,b.jsxs)(t.ZP,{item:!0,xs:12,sm:6,children:[(0,b.jsx)(i.Z,{variant:"h5",component:"h5",children:"Confirm Password"}),(0,b.jsx)(n.Z,{fullWidth:!0,margin:"normal",name:"conform_password",type:"password",value:J.values.conform_password,onChange:J.handleChange,onBlur:J.handleBlur,error:J.touched.conform_password&&Boolean(J.errors.conform_password),helperText:J.touched.conform_password&&J.errors.conform_password,InputProps:{startAdornment:(0,b.jsx)(l.Z,{position:"start",children:(0,b.jsx)(j.Z,{})})}})]})]})}),(0,b.jsx)(m.Z,{sx:{mt:3,mb:2}}),(0,b.jsx)(p.Z,{sx:{justifyContent:"flex-end"},children:(0,b.jsx)(h.Z,{variant:"contained",type:"submit",children:G?"Update Password":"Add User"})})]})})})]})}}}]);